# main.py

from gpt_module import ask_gpt
from db_module import init_db, save_client, save_message

if __name__ == "__main__":
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
    init_db()

    # –ü—Ä–∏–º–µ—Ä–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã–π)
    chat_id = 123456  # –í —Ä–µ–∞–ª—å–Ω–æ–º –±–æ—Ç–µ —Å—é–¥–∞ –±—É–¥–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å Telegram chat_id

    # –ú–∏–Ω–∏-–æ–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    print("üí¨ –í–≤–µ–¥–∏ —Å—Ç—Ä–∞–Ω—É –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:")
    country = input("> ")

    print("üí¨ –í–≤–µ–¥–∏ –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞ –ø–æ–µ–∑–¥–∫–∏ (YYYY-MM-DD):")
    date_from = input("> ")

    print("üí¨ –í–≤–µ–¥–∏ –¥–∞—Ç—É –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–µ–∑–¥–∫–∏ (YYYY-MM-DD):")
    date_to = input("> ")

    print("üí¨ –í–≤–µ–¥–∏ –±—é–¥–∂–µ—Ç –≤ —Ç–µ–Ω–≥–µ:")
    budget = input("> ")

    print("üí¨ –°–∫–æ–ª—å–∫–æ –≤–∑—Ä–æ—Å–ª—ã—Ö?")
    adults = input("> ")

    print("üí¨ –°–∫–æ–ª—å–∫–æ –¥–µ—Ç–µ–π?")
    children = input("> ")

    print("üí¨ –ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?")
    name = input("> ")

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å –∫–ª–∏–µ–Ω—Ç–∞ –≤ –±–∞–∑—É
    save_client(
        chat_id=chat_id,
        name=name,
        country=country,
        date_from=date_from,
        date_to=date_to,
        budget=int(budget),
        adults=int(adults),
        children=int(children)
    )

    print("\n‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω! –¢–µ–ø–µ—Ä—å –Ω–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –±–æ—Ç–∞:")

    user_input = input("> ")

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    save_message(chat_id, "user", user_input)

    # –§–æ—Ä–º–∏—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏—é –æ–±—â–µ–Ω–∏—è –¥–ª—è GPT
    history = [
        {"role": "system", "content": "–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø–æ–¥–±–æ—Ä—É —Ç—É—Ä–æ–≤. –£—Ç–æ—á–Ω—è–π —Å—Ç—Ä–∞–Ω—É, –¥–∞—Ç—ã, –±—é–¥–∂–µ—Ç, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–ª–æ–≤–µ–∫. –ë—É–¥—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º, —Å –ª—ë–≥–∫–∏–º —é–º–æ—Ä–æ–º."},
        {"role": "user", "content": user_input}
    ]

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ GPT
    gpt_reply = ask_gpt(history)

    print(f"\nü§ñ GPT –æ—Ç–≤–µ—á–∞–µ—Ç:\n{gpt_reply}")

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
    save_message(chat_id, "assistant", gpt_reply)